	<?php echo '<?xml version="1.0" encoding="utf-8"?>'; ?>
	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
	<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
	<title>Dimitri & Alice - Accommodations & Reservations</title>
	<meta http-equiv="Content-Type" content="text/html; charset =utf-8" />
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<meta name="generator" content="Rvglobalsoft" />
	<meta name="progid" content="Version: 4.50 PRO; Project name: Dimitri and Alice; Project id: 8c4ecb967d961441575fd98192e10d28; Template Name: pro_21-757-1_black_flower_1; Published date: December 20, 2010, 11:06 21 (GMT -06:00" />
	 
	<link rel="stylesheet" href="http://dimitriandalice.com/style.css" type="text/css" />
	<link rel="stylesheet" href="http://dimitriandalice.com/Georgia.css" type="text/css" />
	<link rel="stylesheet" href="http://dimitriandalice.com/Navigator.css" type="text/css" />
	<link rel="stylesheet" href="http://dimitriandalice.com/pathway.css" type="text/css" />

	<script  type="text/javascript" src="http://dimitriandalice.com/rvsincludefile/rvsheadpage.js"></script>
	<script type="text/javascript" src="http://dimitriandalice.com/rvsincludefile/rvsnavigator.js"></script>
	<script type="text/javascript" src="http://dimitriandalice.com/js/publishNavigator/layersmenu-library.js"></script>
	<script type="text/javascript" src="http://dimitriandalice.com/js/publishNavigator/layersmenu.js"></script>
	<script  type="text/javascript" src="http://dimitriandalice.com/rvsincludefile/rvscustomopenwindow.js"></script>
	</head>
	<style>
		table.myResTable { width: 680px; padding: 0px; border: 1px solid #789DB3; }
		table.myResTable td { border: none; background-color: #F4F4F4; vertical-align: middle; text-align: center; padding: 3px; }
		table.myResTable th { width:120px; border-bottom: 1px solid #000000; }
		table.myResTable tr.topRow td { border-bottom: 1px solid #000000;  }
		table.myResTable td.description { width:300px; text-align:left; border-bottom:0px ; border-left: 1px solid #000000; }
		.rtAlign { text-align:right; }
	</style>
	<body>
	<noscript>
		This page uses Javascript.<br/>
		Your browser either does not support Javascript, or you have it turned off.<br/>
		You will need Javascript to access the room reservation system.<br/>
	</noscript>
	<table cellpadding="0" cellspacing="0" id="rv_top_adjust_width_0" width="1024x768" align="Center" >
		<tr>
			<td align="left" valign="top">
				<table cellpadding="0" cellspacing="0" width="990">
					<tr>
						<td align="left" valign="top"> 
							<!-- START LOGO -->
							<div style="position: absolute;">
								<div id="Layer1" style="position:relative; left:140px; top:15px; width:120; height:60; text-align:center; z-index:1; overflow:visible; white-space:nowrap;"><!-- START LOGO --><a href="http://dimitriandalice.com/index.php" >
		<img src="http://dimitriandalice.com/LOGO.JPG?900c27f8c21acdf5b2f9338d5b090972" width="120" height="70" border="0" alt="Logo" />
	</a><!-- END LOGO --></div>
							</div>
							<div style="position: absolute;">
								<div id="Layer2" style="position:relative; left:280px; top:20px; width:auto; height:auto; text-align:left; z-index:2; overflow:visible; white-space:nowrap;" class="company">Dimitri and Alice</div>
							</div>
							<div style="position: absolute;">
								<div id="Layer3" style="position:relative; left:280px; top:50px; width:auto; height:auto; text-align:left; z-index:3; overflow:visible; white-space:nowrap;" class="slogan"></div>
							</div>
							<!-- END LOGO -->	
							<table cellpadding="0" cellspacing="0">
								<tr>
									<td align="left" valign="top"><img src="images/img_01.jpg" alt="" width="162" height="199" /></td>
									<td align="left" valign="top"><img src="images/img_02.jpg" alt="" width="290" height="199" /></td>
									<td align="left" valign="top"><img src="images/img_03.jpg" alt="" width="285" height="199" /></td>
									<td align="left" valign="top"><img src="images/img_04.jpg" alt="" width="253" height="199" /></td>
								</tr>
							</table>
						</td>
					</tr>
					<tr>
						<td align="left" valign="top" bgcolor="#ffffff">
							<table cellpadding="0" cellspacing="0" width="100%">
								<tr>
								  <td align="left" valign="top"> 
										<table cellpadding="0" cellspacing="0" width="100%">
											<tr>
												<td align="left" valign="top"><img src="images/mu_01.jpg" alt="" width="28" height="42" /></td>
												<td align="left" class="top_mu"><img src="images/mu_02.jpg" alt="" width="134" height="42" /></td>
												<td align="right" valign="top"><img src="images/mu_03.jpg" alt="" width="18" height="42" /></td>
											</tr>
											<tr>
												<td align="left" valign="top" class="mu_l"><img src="images/mu_04.jpg" alt="" width="28" height="195" /></td>
												<td align="left" valign="top">
													<table cellpadding="0" cellspacing="0" width="100%">
														<tr>
															<td align="left" valign="top" height="32" class="menu">
																<div class="navigator">
																	<ul class="navigator">
																	<li><a href="index.php"  class="normal"  target="_self" ><span>Home</span></a></li>
																	<li><a href="About-us.php"  class="normal"  target="_self" ><span>About us</span></a></li>
																	<li><a href="News--and--Blog.php"  class="normal"  target="_self" ><span>News & Blog</span></a></li>
																	<li><a href="Venue.php"  class="normal"  target="_self" ><span>Venue</span></a></li>
																	<li><a href="RSVP.php"  class="normal"  target="_self" ><span>RSVP</span></a></li>
																	<li><a href="Schedule--and--Activities.php"  class="normal"  target="_self" ><span>Schedule & Activities</span></a></li>
																	<li><a href="Accommodations.php" id="current"   target="_self" ><span>Accommodations</span></a></li>
																	<li><a href="Travel.php"  class="normal"  target="_self" ><span>Travel</span></a></li>
																	<li><a href="Gifts.php"  class="normal"  target="_self" ><span>Gifts</span></a></li>
																	<li><a href="pics/index.php"  class="normal"  target="_self" ><span>Pics</span></a></li>
																	</ul>
																</div>
															</td>
														</tr>
													</table>
												</td>
												<td valign="bottom" align="left" class="mu_r"><img src="images/mu_05.jpg" alt="" width="18" height="195" /></td>
											</tr>
											<tr>
												<td align="left" class="bottom_mu"><img src="images/mu_06.jpg" alt="" width="28" height="21" /></td>
												<td align="right" class="bottom_mu "><img src="images/mu_07.jpg" alt="" width="134" height="21" /></td>
												<td align="left"><img src="images/mu_08.jpg" alt="" width="18" height="21" /></td>
											</tr>
										</table>
									</td>
									<td align="left" valign="top" width="99%">
										<table cellpadding="0" cellspacing="0" width="100%">
												

											<!-- Begin PATHWAY and ICON -->
											<tr>
												<td class="magin">
													<table cellpadding="0" cellspacing="0" width="100%">
														<tr>
															<!-- Begin PATHWAY -->
															<td align="left" width="99%"><?php include("/home/dimitria/public_html/rvsincludefile/pathway_ac7e6a6825fb4a0c62884ae048d8dc73.html"); ?></td>
															<!-- End PATHWAY -->
															<!-- Begin ICON -->
															<td align="right"><?php include("/home/dimitria/public_html/rvsincludefile/icon_ac7e6a6825fb4a0c62884ae048d8dc73.html"); ?></td>
															<!-- End ICON -->
														</tr>
													</table>								
												</td>
											</tr>
											<!-- End PATHWAY and ICON -->
											<tr>
												<td align="left" valign="top">
													<table cellpadding="0" cellspacing="0" width="100%">
														<tr>
															<td align="left" valign="top" class="magin" id="rv_adjust_width_189" width="835">
	<!-- START Custom Content -->
	<table cellpadding="0" cellspacing="0" width="100%">  <tr>    <td align="left" valign="top" width="100%" id="layout_zone1" style = ""><div align="center">
	<div align="center"><font style="font-size: 24px">Moon River Ranch</font></div>
	<div align="center"><font style="font-size: 24px"><strong>On-site Accommodations<br/>& <a href="#reservationTop">Reservations</a></strong> </font><br />
	</div>
	<div align="center">&nbsp;</div></div>
	<div align="center">
	<div align="center"><img alt="" title="" src="documents/venue/photos_family_reunions_lake.jpg" width="500" height="346" /></div></div>
	<div>&nbsp;</div>
	<div align="center">Hopefully you'll consider staying on the ranch with us!&nbsp; Not only will you be near the excitement and the cool wedding people, you'll also get all of the luxuries of this fantastic, rustic, relaxing resort.</div>
	<div>&nbsp;</div>
	<div align="center">Below the pictures is a reservation form where you can reserve, and put a down payment on, a room. </div>
	<div>&nbsp;</div>
	<div align="center"><img alt="" title="" src="documents/venue/photos_corporate_retreats_barn_outside.jpg" width="500" height="335" />&nbsp;</div>
	<div>&nbsp;</div>
	<div align="center"><img alt="" title="" src="documents/venue/photos_private_vacations_cabin_inside_2.jpg" width="500" height="346" /></div>
	<div>&nbsp;</div>
	<div align="center"><img alt="" title="" src="documents/venue/photos_family_reunions_front_porch.jpg" width="500" height="345" /></div>
	<div>&nbsp;</div>
	<div align="center"><img alt="" title="" src="documents/venue/photos_family_reunions_pool_evening.jpg" width="500" height="359" /></div>
	<div>&nbsp;</div>
	<div>&nbsp;</div>
	<div>Below is the Reservation form if you would like to purchase a room, bunk, or Airstream on the ranch.&nbsp; You can choose to have the accommodation for one night, or two.&nbsp;  <b>Friday night and Sunday morning meals are included</b> in the prices. </div>
	<div>&nbsp;</div>
	<div>
	<div>Exact room location will be assigned at the wedding.&nbsp; A full payment can be made now, or you can make a down payment of half, with the other half due at the event.</div></div>
	<div>
	<div>&nbsp;</div></div>
	<div>All credit card purchases are through a secure site on PayPal.&nbsp; They will go directly to Dimitri and Alice, who will pay the venue.</div>
	<div>&nbsp;</div>
	<hr style="width: 50%" align="left"/>
	<a name="reservationTop"><h1>Reservations</h1></a>
	<div id="orderConfirmation"></div>
	<form id="resForm" onsubmit="return submitForm()" method="post">
	<div>To begin, please select your name from the list.</div>
	<div>If your name is not in this list then <u><a href="http://dimitriandalice.com/RSVP.php" title="">RSVP here</a></u>, first.</div><br />
		<select id="nameSelect" name="guest_name" onchange="guestSelected( this.options[ this.selectedIndex ].value )">
			<?php
				require_once("/home/dimitria/public_html/scripts/utility.php");
				require_once("/home/dimitria/public_html/scripts/constants.php");
				// Connect to mySQL and navigate to my wedding database
				$linkID = @mysql_connect( "localhost", WEDDING_DB_USER, WEDDING_DB_PASSWORD ) 
						  or die( "Error opening database: " . mysql_error() . ". please try again.  If the problem persists then please email <a href=\"mailto:dimitri@dimitriandalice.com\">dimitri@dimitriandalice.com</a>" );
				mysql_select_db("dimitria_wedding2");
				print Utils::PopulateGuestList();
			?>
		</select><br/>
		<br/>
		<div id="hideableSection">
			<div id="roomTables">
				<div class="tableTemplate">
					<table id="roomTable" class="myResTable">
						<tr class="topRow">
							<th id="roomType"/>
							<td>Friday night</td>
							<td>Saturday night</td>
							<td class="description" rowspan="3">-- sleeps <span id="sleeps"></span>--<br/><span id="description"></span></td>
						</tr>
						<tr>
							<td>1 night: $<span id="price1nt"></span> ea.</td>
							<td><span id="remainFri"></span><span id="remainFriText"> remaining</span></td>
							<td><span id="remainSat"></span><span id="remainSatText"> remaining</span></td>
						</tr>
						<tr>
							<td>2 nights: $<span id="price2nt"></span></td>
							<td>qty: <input id="qtyFri" type="text" size="2" maxlength="2" defaultValue=""/></td>
							<td>qty: <input id="qtySat" type="text" size="2" maxlength="2" defaultValue=""/></td>
						</tr>
					</table><br/>
				</div>
			</div>
			<b>Payment options:</b><br/>
			<input type="radio" name="amtToPay" value="full" onClick="updateTotal( null )" checked="true" ID=Radio1/>Full amount now<br/>
			<input type="radio" id="payHalf" name="amtToPay" value="half" onClick="updateTotal( null )" />Half now, half at event<br/>
		</div>
		<div  id="totalDueDiv">
		<p><b>Total due: $<span id="totalDue"></span></b></p>
		<p id="dueNowP"><i>Due Now: $<span id="dueNow"></span></i><br/></p>
		</div>
		<input type="reset" name="reset" value="Start Over" onClick="resetForm()" ID=Reset1/>
		<input type="submit" name="submit" value="Make Reservation" ID=Submit1/>
	</form>
	<br/>
	<hr style="width: 50%" align="left"/>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js" type="text/javascript"></script>	
	<script type="text/javascript">
		// Useful get-var parser by Josh Fraser
		function $_GET(q,s) 
		{
			s = (s) ? s : window.location.search;
			var re = new RegExp('&'+q+'=([^&]*)','i');
			return (s=s.replace(/^\?/,'&').match(re)) ? s=s[1] : s='';
		}
		
		// Auto-run funcs
		// (need to make sure doc is loaded, first)
		$(document).ready(function()
		{
			// Hide the template table
			$("#dueNowP").hide();
			if ( $_GET( 'status' ) != "" )
				switch ( $_GET( 'status' ) )
				{
					case "reserved":
						$("#hideableSection").hide();
						$("#resForm").hide();
						$("#orderConfirmation").html( "<h3>Thank you for placing a reservation!</h3>" +
														"Your payment of $" + $_GET( 'message' ) + " is processing.<br/>" +
														"You will get a confirmation email shortly!<br/><br/>" +
														"We're excited to have you out there with us!<br/>" );
						break;
					case "canceled":
						$("#hideableSection").hide();
						$("#orderConfirmation").html( "<h3>Order was canceled.</h3>" );
						cancelOrder( $_GET( 'resID' ) );
						break;
				}						
			
			// set some global AJAX defaults
			$.ajaxSetup(
			{
				cache: false,
				type: "POST",
				dataType: "json",
				error: onAjaxError,
				traditional: false,
				url: "scripts/accommHandler.php"
			});

			// zero all values and create tables
			$(":text").val("");
			$("#nameSelect").get().selectedIndex = 0;
			createTables();

		});
		
		// TODO: add roomdata reload on form reset
		// TODO: set up auto-email reminders for event and Payment Due
		// TODO: secure paypal log
		
		// Room data, loaded server-side from the wedding database
		var roomData = 
		{
			<?php
				// Populate Javascript array with room type data
				$result = mysql_query( "SELECT room_type, price_1nt, price_2nt, remain_fri, remain_sat, sleeps_ea, description FROM room_types ORDER BY price_1nt DESC" );
				$first = TRUE;
				while ( $row = mysql_fetch_row( $result ) ) 
				{
					if ( $first )
						$first = FALSE;
					else
						print ",";
					
					print "\t\"$row[0]\": { price1nt:$row[1], price2nt:$row[2], remainFri:$row[3], remainSat:$row[4], sleeps:$row[5], description:\"" . addslashes( $row[6] ) . "\" }\n\t";
				}
			?> 
		};
		
		/***************************************************
		 * Class for holding reservation data.  Can instantiate and null easily
		 */
		function ReservationData ( newName, newGuestID ) 
		{ 
			this.name = newName;
			this.guestID = newGuestID;
			this.resIDs = [];
			this.totalDue = 0;
			this.dueNow = 0;
			this.rooms = {};
		};
		ReservationData.prototype.serializeRooms = function ()
		{
			var outStr = "";
			for ( var roomType in this.rooms )
			{
				outStr += roomType + " (";
				for ( var nights in this.rooms[ roomType ] )
					outStr += this.rooms[ roomType ][ nights ] + " for " + nights + ", ";
				outStr = outStr.substr(0, outStr.length - 2 );
				outStr += "), ";
			}
			return outStr.substr(0, outStr.length - 2 );
		};
		ReservationData.prototype.toString = function ()
		{
			var outStr = "Name: " + this.name + "\n" +
						 "GuestID: " + this.guestID + "\n\n" + 
						 "Room reservations:\n";
			for ( var roomType in this.rooms )
			{
				outStr += "\t" + roomType + "\n";
				for ( var nights in this.rooms[ roomType ] )
					outStr += "\t -- Num. rooms for " + nights + ": " + this.rooms[ roomType ][ nights ] + "\n";
				outStr += "\n";
			}
			
			outStr += "TOTAL DUE: $" + this.totalDue + "\n";
			if ( Number(this.dueNow) < Number(this.totalDue) ) 
			{
				outStr += "Due now: $" + this.dueNow + "\n";
				outStr += "Due at event: $" + this.dueNow + "\n";
			}
			return outStr;
		};
		ReservationData.prototype.toJSON = function ( status )
		{
			return { status: status,
					 name: this.name,
					 guestID: this.guestID,
					 totalDue: this.totalDue,
					 rooms: this.rooms };
		};

		// Global instance var for the current ReservationData
		var currentResData = {};

		/***************************************************
		 * Static struct for handling busy indicator
		 */
		var busyIndic = 
		{
			id: -1,
			status: "",
			start: function ()
			{
				$("#totalDueDiv").after( "<div id=\"busyIndic\"><i>Please Wait... Working.....</i><br/><span id=\"busyStatus\"></span></div>" );
				$("#busyIndic").css({width:'200px', 'background-color':'#bca'});
				this.id = window.setInterval( this.update, 1400 );
			},
			stop: function ()
			{
				if ( this.id != -1 )
				{
					window.clearInterval( this.id );
					$("#busyStatus").text( "" );
					$("#busyIndic").detach();
				}
			},
			update: function ()
			{
				// TODO: iterate the animation of some fancy busy indicator		
				$("#busyIndic").css({width:'300px', 'background-color':'#bca'});
				$("#busyStatus").text( busyIndic.status );
				$("#busyIndic").animate( {width:"600px"}, 500, 'swing', this.update2);
			},
			update2: function ()
			{
				$("#busyIndic").css({width:'600px'});
				$("#busyStatus").text( busyIndic.status );
				$("#busyIndic").animate( {width:"300px"}, 500 );
			}
		}
			
		
		
	//==================================================================================================================
	//Methods 


		/***************************************************
		 * Handles guest selection and creates tables
		 */
		function guestSelected( guestID )
		{
			currentResData = new ReservationData( $("#nameSelect [value='" + guestID + "']").text(), guestID );
			// if guestID == -1 then send to RSVP page
			if ( guestID == -1 ) 
				window.location = "http://dimitriandalice.com/RSVP.php";

			// Otherwise, load any previous, in-progress res's for selected guest
			else if ( guestID != " " )
				$.ajax( { data:{ status:"checkForRes", guestID:guestID, name:currentResData.name }, success:pendingRes } );
			else
				resetForm();
		}
		
		function createTables()
		{
			var firstPass = true;
			var counter = 0;
			for ( var roomType in roomData )
			{
				// clone table template for each row after first
				if ( firstPass ) 
					firstPass = false;
				else
					// appends clone of bottom table to bottom
					$(".tableTemplate:last").clone().appendTo("#roomTables");
				
				// fill in values
				var curRoomData = roomData[ roomType ];
				var curTable = $(".myResTable:last");
				curTable.attr( "roomType", roomType );
				$("#roomType", curTable).text( roomType );
				$("#sleeps", curTable).text( curRoomData.sleeps );
				
				// Fill prices
				$("#price1nt", curTable).text( curRoomData.price1nt );
				$("#price2nt", curTable).text( curRoomData.price2nt );
				var q1 = $("#qtyFri", curTable);
				q1.change( updateTotal );
				q1.attr( "name", "qtyFri" + roomType );
				var q2 = $("#qtySat", curTable)
				q2.change( updateTotal );
				q2.attr( "name", "qtySat" + roomType );

				// Fill Remaining and mark sold-out room types
				fillRemain( "Fri", curTable, roomType );
				fillRemain( "Sat", curTable, roomType );
				$("#description", curTable).text( curRoomData.description );
			}
		}
		
		function fillRemain( day, curTable, roomType )
		{
			var curRoomData = roomData[ roomType ];
			var varName = "remain" + day;
			var n = $("#"+varName, curTable);
			n.text( curRoomData[varName] );
			n.attr( "name", roomType + varName );
			var q = $("#qty" + day, curTable);
			if ( curRoomData[varName] == 0 )
			{
				n.hide();
				q.hide();
				n = $("#" + varName + "Text", curTable);
				n.text( "Sold Out");
				n.css( "color", "red" );
			}
			else
			{
				n.show();
				q.show();
				n = $("#" + varName + "Text", curTable);
				n.text( " remaining");
				n.css( "color", "black" );
			}
		}

		/***************************************************
		 * Updates amount due and #-remaining for all room types
		 * @param 	e - if this isn't null then it's from the qty input value.  Name is "qty[day]_[roomType]"
		 */
		function updateTotal( e )
		{
			// validate entry...
			if ( e )
				if ( isNaN(e.target.value) )
				{
					window.alert( "Must enter a number!" );
					e.target.value = "";
				}
				else
				{
					var roomType = e.target.name.substr( 6 );
					var day = e.target.name.substr( 3, 3 );
					var remain = roomData[ roomType ]["remain" + day]
								 - $("[name='qty" + day + roomType + "']" ).val();
					if ( remain < 0 )
					{
						window.alert( "Not enough available!  Only " + ( remain + Number( e.target.value ) ) + " remaining!" );
						e.target.value = "";
					}
				}
			
			// update totals...
			currentResData.rooms = {};
			$("#totalDue").text(0);
			var allRoomTables = $(".myResTable");
			if ( allRoomTables.length > 1 )
				allRoomTables.each( function()
				{
					var roomType = $("#roomType", this).text();
					var qF = Number( $("#qtyFri", this).val() );
					var qS = Number( $("#qtySat", this).val() );
					$("#remainFri", this).text( roomData[ roomType ].remainFri - qF );
					$("#remainSat", this).text( roomData[ roomType ].remainSat - qS );
					if ( qF + qS > 0 ) currentResData.rooms[ roomType ] = {};
					if ( qF > 0 ) currentResData.rooms[ roomType ]["Friday"] = qF;
					if ( qS > 0 ) currentResData.rooms[ roomType ]["Saturday"] = qS;
					var totalDueNode = $("#totalDue");
					var totalDue = Number( totalDueNode.text() );
					if ( qF > qS ) 
						totalDue += roomData[ roomType ].price1nt * (qF-qS) + roomData[ roomType ].price2nt * qS;
					else
						totalDue += roomData[ roomType ].price1nt * (qS-qF) + roomData[ roomType ].price2nt * qF;
					totalDueNode.text( totalDue );
				});
			
			// process payment type and pad total with zeros
			if ( $("#totalDue").text() > 0 )
			{
				$("#totalDueDiv").css( "background-color", "#ffff88" );
				var tdStr = currentResData.totalDue = currentResData.dueNow = Number($("#totalDue").text()).toFixed(2);
				$("#totalDue").text( tdStr );
				if ( $("#payHalf").attr("checked") )
				{
					currentResData.dueNow = (tdStr /= 2).toFixed(2);
					$("#dueNowP").show("normal");
					$("#dueNow").text( currentResData.dueNow );
				}
				else
					$("#dueNowP").hide("normal");
				
			}
			else
			{
				$("#totalDueDiv").css( "background-color", "" );
				$("#dueNowP").hide("normal");
			}
		}
		
		/***************************************************
		 * Resets all values and hides table
		 */
		function resetForm()
		{
			busyIndic.stop();
			$(":text").val("");
			$.ajax( { data:{ status:"getRoomRemains", name:"Reset" }, success:reloadRemains } );
			updateTotal( );		
			//guestSelected( " " );
			//$("#hideableSection").hide("normal");
		}	

		/***************************************************
		 * Uses AJAX techniques for passing reservation info back to server
		 */
		function submitForm()
		{
			if ( currentResData.guestID == " " )
			{
				window.alert( "Must select your name from the drop-down list!" );
				return false;
			}
			
			if ( $("#totalDue").text() == 0 )
			{
				window.alert( "No rooms selected!" );
				return false;
			}
			
			// start timer that calls updateBusyIndicator() every 500 ms
			busyIndic.start();
			
			// assemble all roomtype/qty pairs (qty is total of both 1 and 2 night)
			spinLockPost( currentResData.toJSON( "checkAvail" ), resCheck );
			return false;
		}
		
		/***************************************************
		 * Handles spin-locking of a table within an AJAX call
		 * The functionality of this has changed a little since I moved the spin-locking into a utility.php func
		 * This will instead just listen for notices stored in busy.msg every couple seconds until the call is completed.
		 */
		function spinLockPost( data, callback )
		{
			$.ajax( { data:data, success:callback } );
			// TODO: start busy indic
			// TODO: have busy indic check busy.msg and display any of its contents
		}

	//{--------------------------------------------- AJAX Callbacks ---------------------------------------------
		/***************************************************
		 * AJAX Callback for checking a reservation
		 */
		function pendingRes( data )
		{
			// if data contains an array of resIDs then populate table with those reservations
			if ( data && data.payload instanceof Array && data.payload.length > 0 )
			{
				// if no qty's entered then fill them with previous, pending reservation
				if ( currentResData.totalDue == 0 )
					for ( var i in data.payload )
					{
						var roomObj = data.payload[i];
						var myTable = $("[roomType=" + roomObj.room_type + "]");
						if ( roomObj.num_Fri > 0 ) $("#qtyFri", myTable).val( roomObj.num_Fri );
						if ( roomObj.num_Sat > 0 ) $("#qtySat", myTable).val( roomObj.num_Sat );
					}
				// reload the new remaining values
				$.ajax( { data:{ status:"getRoomRemains", name:currentResData.name }, success:reloadRemains } );
			}
		}

		/***************************************************
		 * AJAX Callback for reloading room remain #s
		 */
		function reloadRemains ( data )
		{
			if ( data.payload instanceof Array && data.payload.length > 0 )
			{
				for ( var i in data.payload )
				{
					var roomObj = data.payload[i];
					$('[roomType="' + roomObj.room_type + '"] #remainFri').text( roomData[ roomObj.room_type ].remainFri = roomObj.remainFri );
					$('[roomType="' + roomObj.room_type + '"] #remainSat').text( roomData[ roomObj.room_type ].remainSat = roomObj.remainSat );
				}
				updateTotal();
			}
		}
		
		/***************************************************
		 * AJAX Callback for checking a reservation
		 */
		function resCheck( data )
		{
			// Room quantities invalid?
			if ( data == null || data.status != "" )
			{
				window.alert( "One or more of your room requests did not go through.\n" +
							  "Reason:\n" +
							  data.status );
				resetForm();
				return;
			}
			
			// Otherwise, we can assume all requested rooms were available and the server handler placed a lock on them
			busyIndic.stop();
			if ( window.confirm( "CONFIRMATION OF ORDER\n\n" +
								 "Please verify the information below:\n\n" +
								 currentResData.toString() + "\n\n" +
								 "(Press OK to see Cancellation Policy)" ) )
			{
				if ( window.confirm( "CANCELLATION POLICY\n\n"+
									 "If, for any reason, you need to cancel your reservation\n"+
									 "please contact Dimitri at: Dimitri@DimitriAndAlice.com\n\n"+
									 "A full refund of the amount paid will be sent through Paypal\n"+
									 "for any cancellations received before 11:59pm, April 20th.\n\n"+
									 "For cancellations received After April 20th, the amount paid,\n"+
									 "less 50% of the Total Reservation Cost, will be refunded.\n"+
									 "(This means that if you only deposited half, you will receive no\n"+
									 "refund.)\n\n" +
									 "Click OK if you accept these terms." ) )
				{
					busyIndic.start();
					spinLockPost( currentResData.toJSON( "makeRes" ), resConfirmedNowPay );
				}
				else
					// release all locks
					$.ajax( { data: currentResData.toJSON( "cancel" ), name:currentResData.name } );
			}
			else
				// release all locks
				$.ajax( { data: currentResData.toJSON( "cancel" ), name:currentResData.name } );
		}
		
		/***************************************************
		 * AJAX for placing a reservation
		 */
		function resConfirmedNowPay( data )
		{
			// Error placing reservation?
			if ( data.status != "" || data.payload == "" )
			{
				window.alert( "Error placing reservation!\n" +
							  "Reason:\n" +
							  data.status );
				window.location.reload();
			}
			
			currentResData.resIDs = data.payload;
			
			//window.alert( "Reservation Made!" );
			
			// Send to PayPal....
			var ppSubmission = 
			{
				cmd: "_xclick",
				business: "dimitri@dimitriandalice.com",
				//business: "seller_1292859600_biz@gmail.com", //sandbox
				no_shipping: 1,
				notify_url: "http://dimitriandalice.com/scripts/ipnHandler.php",
				custom: currentResData.guestID + ";" + currentResData.resIDs.join(','),
				item_name: currentResData.serializeRooms(),
				'return': "http://dimitriandalice.com/Accommodations.php?status=reserved&message=" + currentResData.dueNow + "#reservationTop",
				cancel_return: "http://dimitriandalice.com/Accommodations.php?status=canceled&resID=" + currentResData.resIDs.join(',') + "#reservationTop",
				cbt: "Return to DimitriAndAlice.com",
				amount: currentResData.dueNow,
				cpp_header_image: "http://dimitriandalice.com/documents/Header.JPG"
			};
			//window.location.assign( "https://www.sandbox.paypal.com/cgi-bin/webscr?" + $.param( ppSubmission, true ) );
			window.location.assign( "https://www.paypal.com/cgi-bin/webscr?" + $.param( ppSubmission, true ) );
		}
		
		/***************************************************
		 * AJAX Callback for checking a reservation
		 */
		function cancelOrder( resID )
		{
			// TODO: mark reservation as canceled (active = 0) and add remaining values back to rooms
		}

		/***************************************************
		 * AJAX Global callback for all errors
		 */
		function onAjaxError( xhr, ts, et )
		{
			window.alert( "Server-side error: \n" +
						   xhr.responseText + "\n" +
						   ts + "\n" +
						   et );
		}
	//}--------------------------------------------- ================ ---------------------------------------------	
	</script>

	<p>
	<div>
	<div><br />
	<div>
	<div>
	<div>
	<div><h2>Other accommodations:</h2></div>
	<div><b>Marlin, TX (12 miles)</b></div>
	<div>&nbsp;- Budget Inn</div>
	<div>&nbsp;- Relax Inn</div>
	<div>&nbsp;- Marlin Inn</div></div>
	<div>
	<div>&nbsp;- Best Western</div></div></div>
	<div>
	<div>&nbsp;</div></div>
	<div><b>Waco, TX (16 miles)</b></div>
	<div>&nbsp;- Super 8</div>
	<div>&nbsp;- Sleep Inn &amp; Suites</div>
	<div>&nbsp;- Fairfield Inn</div>
	<div>&nbsp;- Hampton Inn</div>
	<div>&nbsp;- Hometown Suites (Hilton)</div></div></div></div></p></td>  </tr></table>
	<br/>
	<b>And for those who don't want a room:</b>
	<div>&nbsp;- Floors and couches (bring a sleeping bag)</div>
	<div>&nbsp;- Single teepee on-site (e-mail me)</div>
	<div>&nbsp;- Still trying to get tents allowed, but so far no dice.  :-/</div>

	<!-- END Custom Content -->
															</td>
														</tr>
													</table>								
												</td>
											</tr>
											<!-- Begin FOOTER -->
											<tr>
												<td align="center" class="magin"></td>
											</tr>
											<!-- End FOOTER -->
											<!-- Begin BOTTOM -->
											<tr>
												<td align="center" class="magin">
													<div align="center">&nbsp;</div>
													<div align="center">E-mail Dimitri any time, with any questions: <a href="mailto:Dimitri@DimitriandAlice.com?subject=Website%20Question" title="">Dimitri@DimitriandAlice.com</a> </div>
													<div>&nbsp;</div>
													<div align="center"><font style="font-size: smaller">● ©2011 Dugal Designs&nbsp; ● Site template by RVGlobalSoft ● Reservation and RSVP systems coded by Dimitri Hammond ●</font></div>
													<div align="center"><font style="font-size: smaller">&nbsp;</font></div>
												</td>
											</tr>
											<!-- End BOTTOM -->
											<tr>
											 

											<tr>
												<td align="center" valign="bottom">
													<table cellpadding="0" cellspacing="0">
														<tr>
															<td align="center" valign="bottom" class="magin"></td>
															<td width="8"></td>
															<td align="center" valign="bottom" class="magin"></td>
														</tr>
													</table>	
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</td>
					</tr>
					<tr>
						<td align="left" valign="top">
							<table cellpadding="0" cellspacing="0">
								<tr>
									<td><img src="images/img_05.jpg" alt="" width="180" height="43" /></td>
									<td><img src="images/img_06.jpg" alt="" width="272" height="43" /></td>
									<td><img src="images/img_07.jpg" alt="" width="285" height="43" /></td>
									<td><img src="images/img_08.jpg" alt="" width="253" height="43" /></td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
	</body>
	</html>
